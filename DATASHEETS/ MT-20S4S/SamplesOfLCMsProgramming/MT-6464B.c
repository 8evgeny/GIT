//Пример программы для вывода картинки на индикатор MT-6464B

void main(void) {
byte	p;//Номер текущей страницы индикатора
byte	c;//Позиция по вертикали выводимого байта

	LCDinit();
	for(p=0; p<8; p++) {//Цикл по всем 8-ми страницам индикатора
		WriteCode(p|0xB8);//Установка текущей страницы
		WriteCode(0x40);//Установка текущего адреса для записи данных в 0
		for(c=0; c<64; c++) {//Цикл вывода данных
			WriteData(Logo6464[p][c]);//Вывод очередного байта в индикатор
		}
	}
}

//Процедура программной инициализации индикатора
void LCDinit(void) {
	LCD.E=0;//Начальное значение сигнала индикатору
	LCD.RES=0;//Выдать сигнал RES=0 индикатору
	Delay(>1us);//Задержка на время больше 1 мкс
	LCD.RES=1;//Снять сигнал RES
	Delay(>10us);//Задержка на время больше 10 мкс
	WriteCode(0xC0);//Верхнюю строку на 0
	WriteCode(0x3F);//Display on
}

void Pset(byte x, byte y, bit c) {//Записать одну точку в индикатор (координата 0,0 в левом верхнем углу индикатора)
byte c8;//Временное хранение считаного из индикатора байта
byte m8;//Маска нужного бита в байте
	if ((x>63)||(y>63)) return;//Выход за пределы индикатора
	WriteCode(0xB8|(7-(x>>3)));//Установить нужную страницу индикатора
	WriteCode(y|0x40);//Установить адрес нужного байта
	c8=ReadData();//Фиктивное чтение
	c8=ReadData();//Чтение нужного байта из индикатора
	m8=0x80>>(x&0x07);//Вычислить маску нужного бита в байте
	if (c==1)	//Зажигать точку?
		c8|=m8//Установить нужный бит в байте
	else		//Или гасить точку?
		c8&=~m8;//Сбросить нужный бит в байте
	WriteCode(y|0x40);//Снова установить адрес нужного байта
	WriteData(c8);//Записать изменённый байт обратно в индикатор
}

void WriteCode(byte b) { WriteByte(b,0); }//Команду индикатору

void WriteData(byte b) { WriteByte(b,1); }//Данные индикатору

byte ReadData(void) { return ReadByte(1); }//Прочитать байт данных из индикатора

//Процедура выдачи байта в индикатор
void WriteByte(byte b, bit cd) {
	WaitReady();		//Ждать готовности индикатора
//При необходимости настроить здесь шину данных на вывод
	LCD.RW=0; LCD.A0=cd;	//Выдача байта в индикатор как данных или команды
	LCD.D=b;		//Выдать байт на шину данных индикатора
	Delay(>140ns);		//Это время предустановки адреса (tAW)
	LCD.E=1;		//Сформировать строб записи в индикатор E=1
	Delay(>450ns);		//Длительность сигнала E=1 (время предустановки данных попало сюда (tDS))
	LCD.E=0;		//Сбросить сигнал E
	Delay(>(1000ns-140ns-450ns));	//Минимально допустимый интервал между сигналами E=1
}

byte ReadByte(bit cd) {
byte b;
	WaitReady();		//Ждать готовности индикатора
	LCD.RW=1; LCD.A0=cd;	//Будем читать байт как команду или данные
	Delay(>140ns);		//Это время предустановки адреса (tAW)
	LCD.E=1; 		//Выдать строб в индикатор
	Delay(>450ns);		//Минимально допустимая длительность сигнала E=1 (время доступа (tDDR) попало сюда)
	b=LCD.D;		//Прочитать данные с шины индикатора (они на ней уже минимум 130нс)
	LCD.E=0;		//Сбросить сигнал E
	Delay(>(1000ns-140ns-450ns));	//Минимально допустимый интервал между сигналами E=1
	return b;		//Вернуть прочитанный байт
}

void WaitReady(void) {//Ждать готовности индикатора, опрашивая байт статуса
//При необходимости настроить здесь шину данных на ввод
	LCD.RW=1; LCD.A0=0;	//Чтение флага занятости
	Delay(>140ns);		//Это время предустановки адреса (tAW)
	LCD.E=1; Delay(>450ns);	//Минимальная длительность сигнала E=1 (информация на шину данных индикатором будет выдана раньше, не более чем через 320нс)
	while(LCD.D.7==1);	//Ждать сброса флага занятости
	LCD.E=0;		//Сбросить сигнал E
	Delay(>(1000ns-140ns-450ns));	//Минимально допустимый интервал между сигналами E=1
}
//Данные изображения, побитые по столбцам и байты будут на индикаторе горизонтально.
//Это просто последовательность байт для записи в индикатор начиная с верхней страницы.
//Полностью соответствуют картинке распределения ОЗУ в документации на модуль.
const byte Logo64[8][64]=//64x64 pixel, каждые 8 горизонтальных точек собраны в байт
{
	{	0xFF,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
		0x01,0xE1,0xE1,0xE1,0xE1,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0xF9,0xF9,
		0xF9,0xF9,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0xE1,0xE1,0xE1,0xE1,0x01,
		0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0xFF
	},
	{	0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x07,0x3F,0x3F,0x3F,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x07,
		0x07,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x3F,0x3F,0x3F,0x07,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF
	},
	{	0xFF,0x00,0x00,0x00,0x00,0x0F,0x0F,0x0F,0x0F,0x3F,0x3F,0x3C,0x3C,0x3C,0x3C,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x3C,0x3C,0x3C,0x3C,0x3F,0x3F,0x0F,0x0F,0x0F,0x0F,0x00,0x00,0x00,0x00,0xFF
	},
	{	0xFF,0x00,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x0C,0x0C,0x9C,0xF8,0xF8,
		0xF0,0xF8,0xF8,0xF8,0xF0,0xC0,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x00,0xFF
	},
	{	0xFF,0x00,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x78,0x7C,0x7E,0x3F,0x1F,0x0F,0x07,
		0x03,0x01,0x00,0x00,0x00,0x00,0x01,0x03,0x03,0x03,0x06,0x0E,0x0C,0x0C,0x18,0x38,
		0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x00,0xFF
	},
	{	0xFF,0x00,0x00,0x00,0x00,0x78,0x78,0x78,0x78,0x7E,0x7E,0x1E,0x1E,0x1E,0x1E,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x1E,0x1E,0x1E,0x1E,0x7E,0x7E,0x78,0x78,0x78,0x78,0x00,0x00,0x00,0x00,0xFF
	},
	{	0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0xF0,0xFE,0xFE,0xFE,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xE0,
		0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0xFE,0xFE,0xFE,0xE0,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF
	},
	{	0xFF,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
		0x80,0x87,0x87,0x87,0x87,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x9F,0x9F,
		0x9F,0x9F,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x87,0x87,0x87,0x87,0x80,
		0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xFF
	}
};
